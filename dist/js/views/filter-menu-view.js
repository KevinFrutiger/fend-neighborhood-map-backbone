var app=app||{};(function(){app.FilterMenuView=Backbone.View.extend({el:".js-filter-menu",events:{"click .js-menu-hide":"closeButtonClickHandler","input .js-filter-input":"filterPlaces","keydown .js-filter-input":"filterInputKeydownHandler"},initialize:function(){this.userOpenedMenu=!1,this.inputIsTabKey=!1,this.$closeButton=this.$(".js-menu-hide"),this.$list=this.$(".js-list");var input=$(".js-filter-input");input.val()&&input.val("");var self=this;$(window).resize(function(){self.$(":input").prop("disabled",!(app.widerThanBreakpoint()||self.userOpenedMenu))}),this.listenTo(app.eventBus,"selectionChange",this.selectionChangeHandler),this.render()},render:function(){var filteredModels=app.places.models.filter(function(place){return place.get("filtered")});app.places.models.forEach(function(place){if(place.get("selected")&&filteredModels.indexOf(place)===-1){place.set("selected",!1);var reCenter=!1;app.eventBus.trigger("selectionChange",place,reCenter)}});var listDocFrag=document.createDocumentFragment();filteredModels.forEach(function(place){var listView=new app.FilterItemView({model:place}),listViewEl=listView.render().$el[0];listDocFrag.appendChild(listViewEl)}),this.$list.empty(),this.$list.append(listDocFrag),this.$(":input").prop("disabled",!(app.widerThanBreakpoint()||this.userOpenedMenu))},showMenu:function(){this.$el.toggleClass("filter-menu--visible"),this.userOpenedMenu=!0,this.$(":input").prop("disabled",!1),app.appView.requestFocus(this.$closeButton)},hideMenu:function(shouldHandBackFocus){this.$el.toggleClass("filter-menu--visible"),this.userOpenedMenu=!1,this.$(":input").prop("disabled",!0),app.eventBus.trigger("menuHide",shouldHandBackFocus)},filterPlaces:function(event){if(this.inputIsTabKey)return void(this.inputIsTabKey=!1);var inputValue=event.target.value,re=new RegExp(inputValue,"ig");app.places.models.forEach(function(model){model.set("filtered",re.test(model.get("name")))}),this.render()},selectionChangeHandler:function(place){if(app.places.models.forEach(function(currentPlace){currentPlace!=place&&currentPlace.set("selected",!1)}),this.userOpenedMenu&&place.get("selected")){var handBackFocus=!1;this.hideMenu(handBackFocus)}},closeButtonClickHandler:function(event){var handBackFocus=!0;this.hideMenu(handBackFocus)},filterInputKeydownHandler:function(event){this.inputIsTabKey="Tab"===event.code||"Tab"===event.key||event.keyCode===app.TAB_KEY}})})();